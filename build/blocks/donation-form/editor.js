(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundy/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundy","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0}},"editorScript":"file:./editor.js","viewScript":"fundy-form-script"}'),o=window.React,n=window.wp.blockEditor,r=window.wp.element,i=window.wp.components,a=window.wp.i18n;(0,e.registerBlockType)(t,{edit:function({attributes:{formId:e},setAttributes:t}){var s,l;const[d,u]=(0,r.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:null!==(s=window.fundySettings.apiToken)&&void 0!==s?s:"",baseURL:null!==(l=window.fundySettings.baseURL)&&void 0!==l?l:"",forms:!1,error:null}),{isInitialized:c,isLoaded:p,apiToken:m,baseURL:f,forms:w,error:h}=d;return(0,r.useEffect)((()=>{!1===c&&m&&f&&u({isInitialized:!0})}),[c,m,f]),(0,r.useEffect)((()=>{f&&m&&fetch(f+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+m}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((o=>{const n=o.map((e=>({value:e.id,label:e.name})));u({isLoaded:!0,forms:n,error:null}),e||t({formId:parseInt(n[0].value)})})).catch((e=>{u({error:"There has been a problem with your fetch operation: "+e})}))}),[f,m,e,t]),m?(0,o.createElement)("div",{...(0,n.useBlockProps)()},(0,o.createElement)(i.Placeholder,{label:(0,a.__)("Fundy Form","fundy"),isColumnLayout:!0},(0,o.createElement)(i.SelectControl,{label:(0,a.__)("Select a Form","fundy"),value:e,className:"fundy-form",options:w||[{label:"",value:""}],onChange:e=>t({formId:parseInt(e)}),disabled:!p}),!p&&(0,o.createElement)("p",null,(0,a.__)("Loadingâ€¦","fundy")),h&&(0,o.createElement)("p",null,"Error: "+h))):(0,o.createElement)("div",{...(0,n.useBlockProps)()},(0,o.createElement)(i.Placeholder,{instructions:(0,a.__)("Please set an API Token on the plugin settings page.","fundy")}))},save:()=>null})})();