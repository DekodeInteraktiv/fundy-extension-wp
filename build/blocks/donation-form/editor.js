(()=>{"use strict";const e=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundy/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundy","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0},"urlParams":{"type":"array","default":[],"items":{"type":"object","properties":{"key":{"type":"string"},"value":{"type":"string"}}}}},"editorScript":"file:./editor.js","viewScript":"fundy-form-script"}'),n=window.React,r=window.wp.blockEditor,a=window.wp.element,o=window.wp.components,l=window.wp.i18n;(0,e.registerBlockType)(t,{edit:function({attributes:{formId:e,urlParams:t=[]},setAttributes:i}){var s,u;const[d,c]=(0,a.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:null!==(s=window.fundySettings.apiToken)&&void 0!==s?s:"",baseURL:null!==(u=window.fundySettings.baseURL)&&void 0!==u?u:"",forms:!1,error:null}),{isInitialized:m,isLoaded:p,apiToken:f,baseURL:y,forms:w,error:h}=d;if((0,a.useEffect)((()=>{!1===m&&f&&y&&c({isInitialized:!0})}),[m,f,y]),(0,a.useEffect)((()=>{y&&f&&fetch(`${y}/api/v1/organization/forms`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+f}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok.");return e.json()})).then((t=>{const n=t.map((e=>({value:e.id,label:e.name})));c({isLoaded:!0,forms:n,error:null}),!e&&n.length&&i({formId:parseInt(n[0].value,10)})})).catch((e=>{c({error:"There has been a problem with your fetch operation: "+e})}))}),[y,f,e,i]),!f)return(0,n.createElement)("div",{...(0,r.useBlockProps)()},(0,n.createElement)(o.Placeholder,{instructions:(0,l.__)("Please set an API Token on the plugin settings page.","fundy")}));const k=w&&w.length>0,E=(e,n,r)=>{const a=t.map(((t,a)=>a===e?{...t,[n]:r}:t));i({urlParams:a})};return(0,n.createElement)("div",{...(0,r.useBlockProps)()},(0,n.createElement)(o.Placeholder,{label:(0,l.__)("Fundy Form","fundy"),isColumnLayout:!0},(0,n.createElement)(o.SelectControl,{label:(0,l.__)("Select a Form","fundy"),value:e,className:"fundy-form",options:w||[{label:"",value:""}],onChange:e=>i({formId:parseInt(e,10)}),disabled:!p}),!k&&(0,n.createElement)("p",null,(0,l.__)("No forms found. Please create a Form on your Fundy account first.","fundy")),!p&&(0,n.createElement)("p",null,(0,l.__)("Loadingâ€¦","fundy")),h&&(0,n.createElement)("p",null,"Error: "+h),(0,n.createElement)("div",{className:"fundy-form-params"},(0,n.createElement)("h4",null,(0,l.__)("Default URL Parameters (Optional)","fundy")),(0,n.createElement)("div",{style:{marginTop:"1em"}},t.map(((e,r)=>(0,n.createElement)(o.Flex,{key:`param-${r}`},(0,n.createElement)(o.FlexBlock,null,(0,n.createElement)(o.TextControl,{label:(0,l.__)("Key","fundy"),value:e.key,onChange:e=>E(r,"key",e)})),(0,n.createElement)(o.FlexBlock,null,(0,n.createElement)(o.TextControl,{label:(0,l.__)("Value","fundy"),value:e.value,onChange:e=>E(r,"value",e)})),(0,n.createElement)(o.FlexItem,null,(0,n.createElement)(o.Button,{isDestructive:!0,onClick:()=>(e=>{const n=t.filter(((t,n)=>n!==e));i({urlParams:n})})(r),style:{marginTop:"14px"}},(0,l.__)("Remove","fundy")))))),(0,n.createElement)(o.Button,{variant:"link",onClick:()=>{i({urlParams:[...t,{key:"",value:""}]})}},(0,l.__)("Add Parameter","fundy"))))))},save:()=>null})})();