(()=>{"use strict";const e=window.wp.blocks,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundy","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0}},"editorScript":"file:editor.js","viewScript":"fundy-form-script"}'),t=window.React,o=window.wp.blockEditor,r=window.wp.element,i=window.wp.components,a=window.wp.i18n;(0,e.registerBlockType)(n,{edit:function({attributes:{formId:e},setAttributes:n}){var s,l;const[d,u]=(0,r.useReducer)(((e,n)=>({...e,...n})),{isInitialized:!1,isLoaded:!1,apiToken:null!==(s=window.fundraisingSettings.apiToken)&&void 0!==s?s:"",baseURL:null!==(l=window.fundraisingSettings.baseURL)&&void 0!==l?l:"",forms:!1,error:null}),{isInitialized:c,isLoaded:p,apiToken:m,baseURL:f,forms:w,error:g}=d;return(0,r.useEffect)((()=>{!1===c&&m&&f&&u({isInitialized:!0})}),[c,m,f]),(0,r.useEffect)((()=>{f&&m&&fetch(f+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+m}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((t=>{const o=t.map((e=>({value:e.id,label:e.name})));u({isLoaded:!0,forms:o,error:null}),e||n({formId:parseInt(o[0].value)})})).catch((e=>{u({error:"There has been a problem with your fetch operation: "+e})}))}),[f,m,e,n]),m?(0,t.createElement)("div",{...(0,o.useBlockProps)()},(0,t.createElement)(i.Placeholder,{label:(0,a.__)("Fundy form","fundy"),isColumnLayout:!0},(0,t.createElement)(i.SelectControl,{label:(0,a.__)("Select a form","fundy"),value:e,className:"fundraising-form",options:w||[{label:"",value:""}],onChange:e=>n({formId:parseInt(e)}),disabled:!p}),!p&&(0,t.createElement)("p",null,(0,a.__)("Loadingâ€¦","fundy")),g&&(0,t.createElement)("p",null,"Error: "+g))):(0,t.createElement)("div",{...(0,o.useBlockProps)()},(0,t.createElement)(i.Placeholder,{instructions:(0,a.__)("Please set an API Token on the plugin settings page.","fundy")}))},save:()=>null})})();