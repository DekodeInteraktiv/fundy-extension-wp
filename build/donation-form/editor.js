(()=>{"use strict";const e=window.wp.blocks,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundy","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0}},"editorScript":"file:editor.js","viewScript":"fundy-form-script"}'),n=window.wp.blockEditor,i=window.wp.element,r=window.wp.components,t=window.wp.i18n,s=window.ReactJSXRuntime;(0,e.registerBlockType)(o,{edit:function({attributes:{formId:e},setAttributes:o}){var a,d;const[l,u]=(0,i.useReducer)(((e,o)=>({...e,...o})),{isInitialized:!1,isLoaded:!1,apiToken:null!==(a=window.fundraisingSettings.apiToken)&&void 0!==a?a:"",baseURL:null!==(d=window.fundraisingSettings.baseURL)&&void 0!==d?d:"",forms:!1,error:null}),{isInitialized:c,isLoaded:p,apiToken:f,baseURL:m,forms:w,error:h}=l;return(0,i.useEffect)((()=>{!1===c&&f&&m&&u({isInitialized:!0})}),[c,f,m]),(0,i.useEffect)((()=>{m&&f&&fetch(m+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+f}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((n=>{const i=n.map((e=>({value:e.id,label:e.name})));u({isLoaded:!0,forms:i,error:null}),e||o({formId:parseInt(i[0].value)})})).catch((e=>{u({error:"There has been a problem with your fetch operation: "+e})}))}),[m,f,e,o]),f?(0,s.jsx)("div",{...(0,n.useBlockProps)(),children:(0,s.jsxs)(r.Placeholder,{label:(0,t.__)("Fundy form","fundy"),isColumnLayout:!0,children:[(0,s.jsx)(r.SelectControl,{label:(0,t.__)("Select a form","fundy"),value:e,className:"fundraising-form",options:w||[{label:"",value:""}],onChange:e=>o({formId:parseInt(e)}),disabled:!p}),!p&&(0,s.jsx)("p",{children:(0,t.__)("Loadingâ€¦","fundy")}),h&&(0,s.jsx)("p",{children:"Error: "+h})]})}):(0,s.jsx)("div",{...(0,n.useBlockProps)(),children:(0,s.jsx)(r.Placeholder,{instructions:(0,t.__)("Please set an API Token on the plugin settings page.","fundy")})})},save:()=>null})})();