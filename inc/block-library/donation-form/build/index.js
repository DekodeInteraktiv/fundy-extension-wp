(()=>{"use strict";var e={n:n=>{var o=n&&n.__esModule?()=>n.default:()=>n;return e.d(o,{a:o}),o},d:(n,o)=>{for(var t in o)e.o(o,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:o[t]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.blocks,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundraising","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),t=window.React,r=window.wp.api;var i=e.n(r);const a=window.wp.blockEditor,s=window.wp.element,l=window.wp.components,d=window.wp.i18n;(0,n.registerBlockType)(o,{edit:function({attributes:e,setAttributes:n}){const[o,r]=(0,s.useReducer)(((e,n)=>({...e,...n})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:c,isLoaded:u,apiToken:p,baseURL:f,forms:m,error:w}=o,{formId:g}=e;return(0,a.useBlockEditingMode)(),(0,s.useEffect)((()=>{i().loadPromise.then((()=>{const e=new(i().models.Settings);!1===c&&e.fetch().then((e=>{var n,o;r({apiToken:null!==(n=e.fundraising_option_token)&&void 0!==n?n:"",baseURL:null!==(o=window.fundraisingSettings.baseURL)&&void 0!==o?o:"",isInitialized:!0})})).catch((()=>{r({error:"Sorry, there has been a problem fetching credentials."})}))}))}),[c]),(0,s.useEffect)((()=>{f&&p&&fetch(f+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+p}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{const n=e.map((e=>({value:e.id,label:e.name})));r({isLoaded:!0,forms:n,error:null})})).catch((e=>{r({error:"There has been a problem with your fetch operation: "+e})}))}),[f,p]),p?(0,t.createElement)("div",{...(0,a.useBlockProps)()},(0,t.createElement)(l.SelectControl,{label:(0,d.__)("Select a form","fundraising"),value:g,className:"fundraising-form",options:m||[{label:"",value:""}],onChange:e=>n({formId:e}),disabled:!u}),!u&&(0,t.createElement)("p",null,(0,d.__)("Loadingâ€¦","fundraising")),w&&(0,t.createElement)("p",null,"Error: "+w)):(0,t.createElement)("div",{...(0,a.useBlockProps)()},(0,t.createElement)("p",null,(0,d.__)("Please set an API Token on the plugin settings page.","fundraising")))},save:()=>null})})();