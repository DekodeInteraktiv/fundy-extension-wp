(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundraising","icon":"menu","supports":{"html":false},"attributes":{"formId":{"type":"number","default":0},"title":{"type":"string","default":""},"headingLevel":{"type":"integer","default":3},"description":{"type":"string","default":""}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),o=window.React,i=window.wp.api;var r=e.n(i);const a=window.wp.blockEditor,l=window.wp.element,s=window.wp.components,d=window.wp.i18n;(0,t.registerBlockType)(n,{edit:function({attributes:e,setAttributes:t,className:n}){const[i,c]=(0,l.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:u,isLoaded:p,apiToken:m,baseURL:f,forms:h,error:g}=i,{formId:w,title:b,headingLevel:v,description:k}=e,E="h"+v,_=(0,a.useBlockEditingMode)();return(0,l.useEffect)((()=>{r().loadPromise.then((()=>{const e=new(r().models.Settings);!1===u&&e.fetch().then((e=>{var t,n;c({apiToken:null!==(t=e.fundraising_option_token)&&void 0!==t?t:"",baseURL:null!==(n=window.fundraisingSettings.baseURL)&&void 0!==n?n:"",isInitialized:!0})})).catch((()=>{c({error:"Sorry, there has been a problem fetching credentials."})}))}))}),[u]),(0,l.useEffect)((()=>{f&&m&&fetch(f+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+m}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{const t=[];e.forEach((e=>{t.push({label:e.name,value:e.id})})),c({isLoaded:!0,forms:t,error:null})})).catch((e=>{c({error:"There has been a problem with your fetch operation: "+e})}))}),[f,m]),m?(0,o.createElement)("div",{...(0,a.useBlockProps)()},"default"===_&&(0,o.createElement)(a.BlockControls,{group:"block"},(0,o.createElement)(a.HeadingLevelDropdown,{value:v,onChange:e=>t({headingLevel:e})})),(0,o.createElement)("div",{className:n},(0,o.createElement)(a.RichText,{label:(0,d.__)("Title","fundraising"),value:b,onChange:e=>t({title:e}),placeholder:(0,d.__)("Title…","fundraising"),tagName:E,disabled:!p,allowedFormats:["core/italic","core/bold"]}),(0,o.createElement)(a.RichText,{label:(0,d.__)("Description","fundraising"),value:k,onChange:e=>t({description:e}),placeholder:(0,d.__)("Description…","fundraising"),tagName:"p",disabled:!p,allowedFormats:["core/italic","core/bold","core/strikethrough","core/link"]}),(0,o.createElement)(s.ComboboxControl,{label:(0,d.__)("Select a form","fundraising"),value:w,options:h||[{label:"",value:""}],onChange:e=>t({formId:e}),disabled:!p}),!p&&(0,o.createElement)("p",null,(0,d.__)("Loading…","fundraising")),g&&(0,o.createElement)("p",null,"Error: "+g))):(0,o.createElement)("div",{...(0,a.useBlockProps)()},(0,o.createElement)("div",{className:n},(0,o.createElement)("p",null,(0,d.__)("Please set an API Token on the plugin settings page.","fundraising"))))},save:()=>null})})();