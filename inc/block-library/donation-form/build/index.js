(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundraising","icon":"menu","supports":{"html":false},"attributes":{"formId":{"type":"number","default":0},"title":{"type":"string","default":""},"headingLevel":{"type":"integer","default":3},"description":{"type":"string","default":""}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),o=window.React,i=window.wp.api;var r=e.n(i);const a=window.wp.blockEditor,l=window.wp.element,s=window.wp.components,d=window.wp.i18n;(0,t.registerBlockType)(n,{edit:function({attributes:e,setAttributes:t,className:n,clientId:i}){const[c,u]=(0,l.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:p,isLoaded:m,apiToken:f,baseURL:h,forms:g,error:w}=c,{formId:b,title:v,headingLevel:k,description:E}=e,_="h"+k,y=(0,a.useBlockEditingMode)();return(0,l.useEffect)((()=>{r().loadPromise.then((()=>{const e=new(r().models.Settings);!1===p&&e.fetch().then((e=>{var t,n;u({apiToken:null!==(t=e.fundraising_option_token)&&void 0!==t?t:"",baseURL:null!==(n=window.fundraisingSettings.baseURL)&&void 0!==n?n:"",isInitialized:!0})})).catch((e=>{console.error(e),u({error:"Sorry, there has been a problem fetching credentials."})}))}))}),[p]),(0,l.useEffect)((()=>{h&&f&&fetch(h+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+f}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{let t=[];e.forEach((e=>{t.push({label:e.name,value:e.id})})),u({isLoaded:!0,forms:t,error:null})})).catch((e=>{u({error:"There has been a problem with your fetch operation: "+e})}))}),[h,f]),f?(0,o.createElement)("div",{...(0,a.useBlockProps)()},"default"===y&&(0,o.createElement)(a.BlockControls,{group:"block"},(0,o.createElement)(a.HeadingLevelDropdown,{value:k,onChange:e=>t({headingLevel:e})})),(0,o.createElement)("div",{className:n},(0,o.createElement)(a.RichText,{label:(0,d.__)("Title","fundraising"),value:v,onChange:e=>t({title:e}),placeholder:(0,d.__)("Title...","fundraising"),tagName:_,disabled:!m,allowedFormats:["core/italic","core/bold"]}),(0,o.createElement)(a.RichText,{label:(0,d.__)("Description","fundraising"),value:E,onChange:e=>t({description:e}),placeholder:(0,d.__)("Description...","fundraising"),tagName:"p",disabled:!m,allowedFormats:["core/italic","core/bold","core/strikethrough","core/link"]}),(0,o.createElement)(s.ComboboxControl,{label:(0,d.__)("Select a form","fundraising"),value:b,options:g||[{label:"",value:""}],onChange:e=>t({formId:e}),disabled:!m}),!m&&(0,o.createElement)("p",null,(0,d.__)("Loading...","fundraising")),w&&(0,o.createElement)("p",null,"Error: "+w))):(0,o.createElement)("div",{...(0,a.useBlockProps)()},(0,o.createElement)("div",{className:n},(0,o.createElement)("p",null,(0,d.__)("Please set an API Token on the plugin settings page.","fundraising"))))},save:()=>null})})();