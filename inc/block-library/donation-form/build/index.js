(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundraising","icon":"menu","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0},"title":{"type":"string","default":""},"headingLevel":{"type":"integer","default":2},"description":{"type":"string","default":""}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),r=window.React,i=window.wp.api;var o=e.n(i);const a=window.wp.blockEditor,l=window.wp.element,s=window.wp.components,d=window.wp.i18n;(0,t.registerBlockType)(n,{edit:function({attributes:e,setAttributes:t}){const[n,i]=(0,l.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:c,isLoaded:u,apiToken:p,baseURL:m,forms:f,error:g}=n,{formId:h,title:w,headingLevel:b,description:_}=e,k="h"+b,v=(0,a.useBlockEditingMode)();return(0,l.useEffect)((()=>{o().loadPromise.then((()=>{const e=new(o().models.Settings);!1===c&&e.fetch().then((e=>{var t,n;i({apiToken:null!==(t=e.fundraising_option_token)&&void 0!==t?t:"",baseURL:null!==(n=window.fundraisingSettings.baseURL)&&void 0!==n?n:"",isInitialized:!0})})).catch((()=>{i({error:"Sorry, there has been a problem fetching credentials."})}))}))}),[c]),(0,l.useEffect)((()=>{m&&p&&fetch(m+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+p}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{const t=[];e.forEach((e=>{t.push({label:e.name,value:e.id})})),i({isLoaded:!0,forms:t,error:null})})).catch((e=>{i({error:"There has been a problem with your fetch operation: "+e})}))}),[m,p]),p?(0,r.createElement)("div",{...(0,a.useBlockProps)()},"default"===v&&(0,r.createElement)(a.BlockControls,{group:"block"},(0,r.createElement)(a.HeadingLevelDropdown,{value:b,onChange:e=>t({headingLevel:e})})),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(a.RichText,{label:(0,d.__)("Title","fundraising"),value:w,className:"fundraising-form-wrapper__title",onChange:e=>t({title:e}),placeholder:(0,d.__)("Title…","fundraising"),tagName:k,disabled:!u,allowedFormats:["core/italic","core/bold"]}),(0,r.createElement)(a.RichText,{label:(0,d.__)("Description","fundraising"),value:_,className:"fundraising-form-wrapper__desc",onChange:e=>t({description:e}),placeholder:(0,d.__)("Description…","fundraising"),tagName:"p",disabled:!u,allowedFormats:["core/italic","core/bold","core/strikethrough","core/link"]}),(0,r.createElement)(s.SelectControl,{label:(0,d.__)("Select a form","fundraising"),value:h,className:"fundraising-form",options:f||[{label:"",value:""}],onChange:e=>t({formId:e}),disabled:!u}),!u&&(0,r.createElement)("p",null,(0,d.__)("Loading…","fundraising")),g&&(0,r.createElement)("p",null,"Error: "+g))):(0,r.createElement)("div",{...(0,a.useBlockProps)()},(0,r.createElement)("p",null,(0,d.__)("Please set an API Token on the plugin settings page.","fundraising")))},save:()=>null})})();