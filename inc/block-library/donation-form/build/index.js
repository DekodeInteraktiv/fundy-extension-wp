(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.blocks,t=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"fundraising/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"fundraising","icon":"clipboard","supports":{"html":false,"color":{"background":true,"text":true},"spacing":{"margin":true,"padding":true}},"attributes":{"formId":{"type":"number","default":0}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),o=window.React,r=window.wp.api;var i=e.n(r);const a=window.wp.blockEditor,s=window.wp.element,l=window.wp.components,d=window.wp.i18n;(0,n.registerBlockType)(t,{edit:function({attributes:{formId:e},setAttributes:n}){const[t,r]=(0,s.useReducer)(((e,n)=>({...e,...n})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:c,isLoaded:u,apiToken:p,baseURL:m,forms:f,error:w}=t;return(0,s.useEffect)((()=>{i().loadPromise.then((()=>{const e=new(i().models.Settings);!1===c&&e.fetch().then((e=>{var n,t;r({apiToken:null!==(n=e.fundraising_option_token)&&void 0!==n?n:"",baseURL:null!==(t=window.fundraisingSettings.baseURL)&&void 0!==t?t:"",isInitialized:!0})})).catch((()=>{r({error:"Sorry, there has been a problem fetching credentials."})}))}))}),[c]),(0,s.useEffect)((()=>{m&&p&&fetch(m+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+p}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{const n=e.map((e=>({value:e.id,label:e.name})));r({isLoaded:!0,forms:n,error:null})})).catch((e=>{r({error:"There has been a problem with your fetch operation: "+e})}))}),[m,p]),p?(0,o.createElement)("div",{...(0,a.useBlockProps)()},(0,o.createElement)(l.Placeholder,{label:(0,d.__)("Fundraising form","fundraising"),isColumnLayout:!0},(0,o.createElement)(l.SelectControl,{label:(0,d.__)("Select a form","fundraising"),value:e,className:"fundraising-form",options:f||[{label:"",value:""}],onChange:e=>n({formId:parseInt(e)}),disabled:!u}),!u&&(0,o.createElement)("p",null,(0,d.__)("Loadingâ€¦","fundraising")),w&&(0,o.createElement)("p",null,"Error: "+w))):(0,o.createElement)("div",{...(0,a.useBlockProps)()},(0,o.createElement)(l.Placeholder,{instructions:(0,d.__)("Please set an API Token on the plugin settings page.","fundraising")}))},save:()=>null})})();