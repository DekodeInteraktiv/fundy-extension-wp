(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"donations/donation-form","title":"Donation Form","description":"Displays a donation form.","category":"widgets","textdomain":"donations","icon":"menu","supports":{"html":false},"attributes":{"formId":{"type":"number","default":0},"title":{"type":"string","default":""},"description":{"type":"string","default":""}},"editorScript":"file:../build/index.js","editorStyle":"file:../build/editor.css"}'),n=window.React,i=window.wp.api;var a=e.n(i);window.wp.apiFetch;const r=window.wp.blockEditor,s=window.wp.element,l=window.wp.components,d=window.wp.i18n;(0,t.registerBlockType)(o,{edit:function({attributes:e,setAttributes:t,className:o,clientId:i}){const[c,p]=(0,s.useReducer)(((e,t)=>({...e,...t})),{isInitialized:!1,isLoaded:!1,apiToken:!1,baseURL:!1,forms:!1,error:null}),{isInitialized:u,isLoaded:m,apiToken:w,baseURL:f,forms:b,error:h}=c,{formId:v,title:g,description:E}=e;return(0,s.useEffect)((()=>{a().loadPromise.then((()=>{const e=new(a().models.Settings);!1===u&&e.fetch().then((e=>{var t,o;p({apiToken:null!==(t=e.donations_option_token)&&void 0!==t?t:"",baseURL:null!==(o=window.donationsSettings.baseURL)&&void 0!==o?o:"",isInitialized:!0})}))}))}),[u]),(0,s.useEffect)((()=>{f&&w&&fetch(f+"/api/v1/organization/forms",{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer "+w}}).then((e=>{if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((e=>{let t=[];e.forEach((e=>{t.push({label:e.name,value:e.id})})),p({isLoaded:!0,forms:t,error:null})})).catch((e=>{p({error:"There has been a problem with your fetch operation: "+e})}))}),[f,w]),w?(0,n.createElement)("div",{...(0,r.useBlockProps)()},(0,n.createElement)("div",{className:o},(0,n.createElement)(l.ComboboxControl,{label:(0,d.__)("Select a form","donations"),value:v,options:b||[{label:"",value:""}],onChange:e=>t({formId:e}),disabled:!m}),(0,n.createElement)(l.TextControl,{label:(0,d.__)("Title","donations"),value:g,onChange:e=>t({title:e}),disabled:!m}),(0,n.createElement)(l.TextareaControl,{label:(0,d.__)("Description","donations"),value:E,onChange:e=>t({description:e}),disabled:!m}),!m&&(0,n.createElement)("p",null,(0,d.__)("Loading...","donations")),h&&(0,n.createElement)("p",null,"Error: "+h))):(0,n.createElement)("div",{...(0,r.useBlockProps)()},(0,n.createElement)("div",{className:o},(0,n.createElement)("p",null,(0,d.__)("Please set an API Token on the plugin settings page.","donations"))))},save:()=>null})})();